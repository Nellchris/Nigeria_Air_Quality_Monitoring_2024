<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Nigeria Air Quality Monitoring (2024)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
    .info {
      padding: 8px 12px;
      background: white;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      border-radius: 6px;
      font-size: 13px;
      line-height: 1.4em;
      max-width: 250px;
    }
    .info h4 {
      margin: 0 0 5px;
      color: #444;
      font-size: 14px;
    }
    .legend {
      line-height: 18px;
      color: #555;
      background: white;
      padding: 6px 8px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      border-radius: 6px;
    }
    .legend i {
      width: 18px;
      height: 18px;
      float: left;
      margin-right: 8px;
      opacity: 0.7;
    }
  </style>
</head>
<body>
<div id="map"></div>

<script>
// ====================
// Map Setup
// ====================
var map = L.map('map').setView([9.082, 8.6753], 6);

L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
  subdomains: 'abcd',
  maxZoom: 19
}).addTo(map);

// ====================
// Info Control (top-left)
// ====================
var info = L.control({position: 'topleft'});
info.onAdd = function () {
  var div = L.DomUtil.create('div', 'info');
  div.innerHTML = `
    <h4>Nigeria Air Quality Monitoring</h4>
    <p>
      This map shows state-level averages of 
      <b>Methane (CH₄)</b> and <b>Sulphur Dioxide (SO₂)</b> 
      for 2024, derived from Sentinel-5P.
    </p>
    <p>
      • Use the <b>layer switcher</b> (top-right) to toggle between methane and sulphur dioxide.<br>
      • The legend updates automatically.<br>
      • Click a state to view its values.
    </p>
    <p style="font-size:11px; color:gray;">
      Data Source: Copernicus Sentinel-5P (ESA)<br>
      Processed with Google Earth Engine | Visualized using Leaflet<br>
      © 2025 Nelson Christopher
    </p>
  `;
  return div;
};
info.addTo(map);

// ====================
// Color Scales (using your values)
// ====================
function getColorMethane(d) {
  return d > 1946.7 ? "#800026" :
         d > 1941.4 ? "#BD0026" :
         d > 1936.1 ? "#E31A1C" :
         d > 1930.8 ? "#FC4E2A" :
         d > 1925.5 ? "#FD8D3C" :
                      "#FEB24C";
}

function getColorSO2(d) {
  return d > 0.0000346 ? "#08306b" :
         d > 0.0000266 ? "#2171b5" :
         d > 0.0000185 ? "#4292c6" :
         d > 0.0000105 ? "#6baed6" :
         d > 0.0000024 ? "#9ecae1" :
                         "#c6dbef";
}

// ====================
// Legends
// ====================
var methaneLegend = L.control({position: 'bottomright'});
methaneLegend.onAdd = function () {
  var div = L.DomUtil.create('div', 'legend'),
      grades = [1925.5, 1930.8, 1936.1, 1941.4, 1946.7];
  div.innerHTML = '<b>Methane (mol fraction)</b><br>';
  for (var i = 0; i < grades.length; i++) {
    div.innerHTML +=
      '<i style="background:' + getColorMethane(grades[i] + 0.01) + '"></i> ' +
      grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
  }
  return div;
};

var so2Legend = L.control({position: 'bottomright'});
so2Legend.onAdd = function () {
  var div = L.DomUtil.create('div', 'legend'),
      grades = [0.0000024, 0.0000105, 0.0000185, 0.0000266, 0.0000346];
  div.innerHTML = '<b>SO₂ (mol/m²)</b><br>';
  for (var i = 0; i < grades.length; i++) {
    div.innerHTML +=
      '<i style="background:' + getColorSO2(grades[i] + 0.0000001) + '"></i> ' +
      grades[i].toExponential(2) + (grades[i + 1] ? '&ndash;' + grades[i + 1].toExponential(2) + '<br>' : '+');
  }
  return div;
};

// ====================
// Layers
// ====================
var methaneLayer = L.geoJson(null, {
  style: f => ({
    color: "black",
    weight: 1,
    fillColor: getColorMethane(f.properties.ch4_mean),
    fillOpacity: 0.7
  }),
  onEachFeature: (f, l) => {
    l.bindPopup(`<b>State:</b> ${f.properties.Country}<br>
                 <b>Methane (CH₄):</b> ${f.properties.ch4_mean} mol fraction`);
  }
});

var so2Layer = L.geoJson(null, {
  style: f => ({
    color: "black",
    weight: 1,
    fillColor: getColorSO2(f.properties.so2_mean),
    fillOpacity: 0.7
  }),
  onEachFeature: (f, l) => {
    l.bindPopup(`<b>State:</b> ${f.properties.Country}<br>
                 <b>Sulphur Dioxide (SO₂):</b> ${f.properties.so2_mean} mol/m²`);
  }
});

// ====================
// Load Data from GitHub
// ====================
fetch("https://raw.githubusercontent.com/Nellchris/Nigeria_Air_Quality_Monitoring_2024/refs/heads/main/Nigeria_ch4_2024.json")
  .then(r => r.json())
  .then(data => methaneLayer.addData(data));

fetch("https://raw.githubusercontent.com/Nellchris/Nigeria_Air_Quality_Monitoring_2024/refs/heads/main/Nigeria_so2_2024.json")
  .then(r => r.json())
  .then(data => so2Layer.addData(data));

// ====================
// Layer Control + Legend Switching
// ====================
var baseMaps = {
  "Methane (CH₄)": methaneLayer,
  "Sulphur Dioxide (SO₂)": so2Layer
};

L.control.layers(baseMaps, null, {collapsed:false}).addTo(map);

// Default layer
methaneLayer.addTo(map);
methaneLegend.addTo(map);

// Switch legends with layer
map.on('baselayerchange', function(e) {
  if (e.name === "Methane (CH₄)") {
    map.removeControl(so2Legend);
    methaneLegend.addTo(map);
  } else if (e.name === "Sulphur Dioxide (SO₂)") {
    map.removeControl(methaneLegend);
    so2Legend.addTo(map);
  }
});
</script>
</body>
</html>
